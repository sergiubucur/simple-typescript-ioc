{"version":3,"sources":["webpack://simple-typescript-ioc/webpack/universalModuleDefinition","webpack://simple-typescript-ioc/webpack/bootstrap","webpack://simple-typescript-ioc/webpack/runtime/define property getters","webpack://simple-typescript-ioc/webpack/runtime/hasOwnProperty shorthand","webpack://simple-typescript-ioc/webpack/runtime/make namespace object","webpack://simple-typescript-ioc/./src/Factory.ts","webpack://simple-typescript-ioc/./src/Container.ts"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","FactoryPrefix","Factory","id","_types","Map","_singletons","register","type","this","_registerType","dependencies","registerSingleton","disposeSingleton","has","Error","delete","resolve","length","_singleton","map","x","Function","bind","apply","singleton","set","callback"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAQ,yBAA2BD,IAEnCD,EAAK,yBAA2BC,IARlC,CASGK,MAAM,WACT,M,mBCTA,IAAIC,EAAsB,CCA1B,EAAwB,CAACL,EAASM,KACjC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAER,EAASO,IAC5EE,OAAOC,eAAeV,EAASO,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3E,EAAwB,CAACM,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClF,EAAyBd,IACH,oBAAXkB,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeV,EAASkB,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeV,EAAS,aAAc,CAAEoB,OAAO,M,mDCLhD,IAAMC,EAAgB,IAEtB,SAASC,EAAQC,GACvB,OAAOF,EAAgBE,E,ICAxB,0BACkB,KAAAC,OAAgC,IAAIC,IACpC,KAAAC,YAAmC,IAAID,IAiEzD,OA/DQ,YAAAE,SAAP,SAAgBJ,EAAYK,G,IAAc,wDACzCC,KAAKC,cAAcP,EAAIK,EAAMG,IAGvB,YAAAC,kBAAP,SAAyBT,EAAYK,G,IAAc,wDAClDC,KAAKC,cAAcP,EAAIK,EAAMG,GAAc,IAGrC,YAAAE,iBAAP,SAAwBV,GACvB,IAAKM,KAAKH,YAAYQ,IAAIX,GACzB,MAAM,IAAIY,MAAM,qDAGjBN,KAAKH,YAAYU,OAAOb,IAGlB,YAAAc,QAAP,SAAed,GAAf,WACOK,EAAOC,KAAKL,OAAOZ,IAAIW,GAE7B,IAAKK,EACJ,MAAM,IAAIO,MAAM,qBAGjB,OAAIP,EAAKG,aAAaO,OAAS,EACvBT,KAAKU,WAAWX,GAAM,WAC5B,IAAMG,EAAeH,EAAKG,aAAaS,KAAI,SAAAC,GAC1C,OAAIA,GAAKpB,GACRoB,GAAQpB,EACD,WAAM,SAAKgB,QAAQI,KAGpB,EAAKJ,QAAQI,MAIrB,OAAO,IAAKC,SAAS3B,UAAU4B,KAAKC,MAAMhB,EAAKA,K,+EAAM,CAAF,CAAG,MAASG,QAK1DF,KAAKU,WAAWX,GAAM,WAAM,WAAIA,EAAKA,SAGrC,YAAAE,cAAR,SAAsBP,EAAYK,EAAcG,EAAwBc,QAAA,IAAAA,OAAA,GACvEhB,KAAKL,OAAOsB,IAAIvB,EAAI,CACnBA,GAAE,EACFK,KAAI,EACJG,aAAY,EACZc,UAAS,KAIH,YAAAN,WAAR,SAAmBX,EAAgBmB,GAClC,OAAInB,EAAKiB,WACHhB,KAAKH,YAAYQ,IAAIN,EAAKL,KAC9BM,KAAKH,YAAYoB,IAAIlB,EAAKL,GAAIwB,KAGxBlB,KAAKH,YAAYd,IAAIgB,EAAKL,KAG3BwB,KAET,EAnEA,G","file":"simple-typescript-ioc.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"simple-typescript-ioc\"] = factory();\n\telse\n\t\troot[\"simple-typescript-ioc\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export const FactoryPrefix = 1000000;\r\n\r\nexport function Factory(id: number) {\r\n\treturn FactoryPrefix + id;\r\n}\r\n","import { TypeInfo } from \"./TypeInfo\";\r\nimport { FactoryPrefix } from \"./Factory\";\r\n\r\nexport class Container {\r\n\tprivate readonly _types: Map<number, TypeInfo> = new Map();\r\n\tprivate readonly _singletons: Map<number, object> = new Map();\r\n\r\n\tpublic register(id: number, type: object, ...dependencies: number[]) {\r\n\t\tthis._registerType(id, type, dependencies);\r\n\t}\r\n\r\n\tpublic registerSingleton(id: number, type: object, ...dependencies: number[]) {\r\n\t\tthis._registerType(id, type, dependencies, true);\r\n\t}\r\n\r\n\tpublic disposeSingleton(id: number) {\r\n\t\tif (!this._singletons.has(id)) {\r\n\t\t\tthrow new Error(\"trying to dispose a singleton which doesn't exist\");\r\n\t\t}\r\n\r\n\t\tthis._singletons.delete(id);\r\n\t}\r\n\r\n\tpublic resolve(id: number): object | undefined {\r\n\t\tconst type = this._types.get(id);\r\n\r\n\t\tif (!type) {\r\n\t\t\tthrow new Error(\"unregistered type\");\r\n\t\t}\r\n\r\n\t\tif (type.dependencies.length > 0) {\r\n\t\t\treturn this._singleton(type, () => {\r\n\t\t\t\tconst dependencies = type.dependencies.map(x => {\r\n\t\t\t\t\tif (x >= FactoryPrefix) {\r\n\t\t\t\t\t\tx = x - FactoryPrefix;\r\n\t\t\t\t\t\treturn () => this.resolve(x);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn this.resolve(x);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\treturn new (Function.prototype.bind.apply(type.type, [null, ...dependencies])); // eslint-disable-line\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// @ts-ignore\r\n\t\treturn this._singleton(type, () => new type.type());\r\n\t}\r\n\r\n\tprivate _registerType(id: number, type: object, dependencies: number[], singleton = false) {\r\n\t\tthis._types.set(id, {\r\n\t\t\tid,\r\n\t\t\ttype,\r\n\t\t\tdependencies,\r\n\t\t\tsingleton\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _singleton(type: TypeInfo, callback: () => object) {\r\n\t\tif (type.singleton) {\r\n\t\t\tif (!this._singletons.has(type.id)) {\r\n\t\t\t\tthis._singletons.set(type.id, callback());\r\n\t\t\t}\r\n\r\n\t\t\treturn this._singletons.get(type.id);\r\n\t\t}\r\n\r\n\t\treturn callback();\r\n\t}\r\n}\r\n"],"sourceRoot":""}